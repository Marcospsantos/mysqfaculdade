 # Atividade elaborada em dupla pelos alunos:
 # Marcos Paulo dos Santos (111000546_2012_01)
 # Jonatas B. Teodoro  (11100010546_20212_02)
 
  create table VINHO(
CODIGO_VINHO BIGINT,
ID_VINICOLA BIGINT,
NOME_VINHO VARCHAR (50),
TIPO_VINHO VARCHAR (30),
ANO_VINHO INT,
DESCRICAO_VINHO TEXT,
primary key (CODIGO_VINHO),
CONSTRAINT FK_VINICOLA FOREIGN KEY (ID_VINICOLA)
    REFERENCES VINICOLA(CODIGO_VINICOLA)
);
create table REGIAO(
CODIGO_REG BIGINT,
NOME_REGIAO VARCHAR(100),
DESCRICAO_REGIAO TEXT,
primary key (CODIGO_REG)
);
create table VINICOLA(
CODIGO_VINICOLA BIGINT,
ID_REGIAO BIGINT,
NOME_VINICOLA VARCHAR (100),
DESCRICAO_VINICOLA TEXT,
TELEFONE_VINICOLA VARCHAR (15),
EMAIL_VINICOLA VARCHAR (15),
primary key (CODIGO_VINICOLA),
CONSTRAINT FK_REGIAO FOREIGN KEY (ID_REGIAO)
    REFERENCES REGIAO(CODIGO_REG)
);
insert into REGIAO(CODIGO_REG, NOME_REGIAO, DESCRICAO_REGIAO) values ('1', 'CURITIBA SUL', 'REGIAO DOS VALES');
insert into REGIAO(CODIGO_REG, NOME_REGIAO, DESCRICAO_REGIAO) values ('2', 'RIO GRANDE', 'MONTANHAS');
insert into REGIAO(CODIGO_REG, NOME_REGIAO, DESCRICAO_REGIAO) values ('3', 'PORTUGAL', 'REGIÃO DAS UVAS BRANCAS');
insert into REGIAO(CODIGO_REG, NOME_REGIAO, DESCRICAO_REGIAO) values ('4', 'ITALIA', 'TOSCANA');
insert into REGIAO(CODIGO_REG, NOME_REGIAO, DESCRICAO_REGIAO) values ('5', 'FRANÇA', 'SUDOESTE DA FRANÇA');

INSERT INTO `loja.vinhos`.vinicola
(CODIGO_VINICOLA, ID_REGIAO,  NOME_VINICOLA, DESCRICAO_VINICOLA, TELEFONE_VINICOLA, EMAIL_VINICOLA)
VALUES(500, 1, 'BART', 'VINHOS DO PORTO', '349988098', 'bar@gmail.com');
INSERT INTO `loja.vinhos`.vinicola
(CODIGO_VINICOLA, ID_REGIAO, NOME_VINICOLA, DESCRICAO_VINICOLA, TELEFONE_VINICOLA, EMAIL_VINICOLA)
VALUES(600, 2, 'UVANIO', 'FÁBRICA DE VINHOS', '177098768', 'fab@gmail.com');
INSERT INTO `loja.vinhos`.vinicola
(CODIGO_VINICOLA, ID_REGIAO, NOME_VINICOLA, DESCRICAO_VINICOLA, TELEFONE_VINICOLA, EMAIL_VINICOLA)
VALUES(700, 3, 'VINCI', 'VINHEDOS', '348766965', 'vinci@gmail.com');
INSERT INTO `loja.vinhos`.vinicola
(CODIGO_VINICOLA, ID_REGIAO, NOME_VINICOLA, DESCRICAO_VINICOLA, TELEFONE_VINICOLA, EMAIL_VINICOLA)
VALUES(800, 4, 'GASPARI', 'CHALÉ DO VINHO', '8732444', 'ga@gmail.com');
INSERT INTO `loja.vinhos`.vinicola
(CODIGO_VINICOLA, ID_REGIAO, NOME_VINICOLA, DESCRICAO_VINICOLA, TELEFONE_VINICOLA, EMAIL_VINICOLA)
VALUES(900, 5, 'PEROLA', 'VINHOS MADEIRA', '776899877', 'mad@gmail.com');

INSERT INTO `loja.vinhos`.vinho
(CODIGO_VINHO, ID_VINICOLA, NOME_VINHO, TIPO_VINHO, ANO_VINHO, DESCRICAO_VINHO)
VALUES(10, 500, 'ARINTO', 'TINTO', 2000, 'AUSTERO');
INSERT INTO `loja.vinhos`.vinho
(CODIGO_VINHO, ID_VINICOLA, NOME_VINHO, TIPO_VINHO, ANO_VINHO, DESCRICAO_VINHO)
VALUES(20, 600, 'SUAVIGNON', 'ROSE', 1989, 'AUSTERO');
INSERT INTO `loja.vinhos`.vinho
(CODIGO_VINHO, ID_VINICOLA, NOME_VINHO, TIPO_VINHO, ANO_VINHO, DESCRICAO_VINHO)
VALUES(30, 700, 'CABERNET', 'BRANCO', 1897, 'ELEGANTE');
INSERT INTO `loja.vinhos`.vinho
(CODIGO_VINHO, ID_VINICOLA, NOME_VINHO, TIPO_VINHO, ANO_VINHO, DESCRICAO_VINHO)
VALUES(40, 800, 'FRANCA', 'ESPUMANTE', 2021, 'LEVE');
INSERT INTO `loja.vinhos`.vinho
(CODIGO_VINHO, ID_VINICOLA, NOME_VINHO, TIPO_VINHO, ANO_VINHO, DESCRICAO_VINHO)
VALUES(50, 900, 'BARBERA', 'TÂNICO', 1994, 'FRUTADO');


select b.nome_vinho, b.ano_vinho, a.nome_vinicola, c.nome_regiao
from vinicola a
join vinho b on a.codigo_vinicola = b.id_vinicola
join regiao c on c.codigo_reg = a.id_regiao 
order by b.ano_vinho

drop user if exists Sommelier@"localhost";

create user Sommelier@"localhost" with max_queries_per_hour 40; #Criação do usuário com privilégios

drop user Sommelier@"localhost"; #Exclusão do usuário para testar

grant select on `loja.vinhos`.vinho to Sommelier@"localhost"; #Privilégios de acesso

grant select (CODIGO_VINICOLA, NOME_VINICOLA) on VINICOLA to Sommelier@"localhost"; #Privilégios de acesso

SELECT User, Host FROM mysql.user; #Consultar os usuários

SHOW GRANTS FOR Sommelier@"localhost"; #Consultar os privilégios do usuário

#Outra consulta SELECT
SELECT
	VINHO.NOME_VINHO , VINHO.ANO_VINHO , VINICOLA.NOME_VINICOLA , REGIAO.NOME_REGIAO 
FROM
	`loja.vinhos`.vinho
INNER JOIN
	`loja.vinhos`.vinicola
	ON vinho.ID_VINICOLA = vinicola.CODIGO_VINICOLA 
INNER JOIN
	`loja.vinhos`.regiao
	ON vinicola.ID_REGIAO = regiao.CODIGO_REG 
ORDER BY
	vinho.NOME_VINHO ASC;

select * from regiao r  ;

